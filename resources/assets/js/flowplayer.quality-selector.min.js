/*!

   Flowplayer HTML5 quality selector plugin

   Copyright (c) 2016, Flowplayer Oy

   Released under the MIT License:
   http://www.opensource.org/licenses/mit-license.php

   revision: cc55c62

*/
!function(e){e(function(t,i){"use strict";function a(e){return e.sources.some(function(e){return/mpegurl/i.test(e.type)})}function n(e){var t=document.createElement("video");return!!t.canPlayType(e).replace("no","")}function l(e,t){var i=/-(\d+p)(\.(mp4|webm))?$/.exec(e);if(i&&-1!==t.indexOf(i[1]))return i[1]}function u(){t.qualities&&t.qualities.length&&t.qualities.forEach(function(e){s.removeClass(i,"quality-"+e)})}function r(e,t){if("abr"===e)return"abr";var i,a=parseInt(e,0);return t.forEach(function(e,n){n!=t.length-1||i||(i=e),parseInt(e)<=a&&parseInt(t[n+1])>a&&(i=e)}),i}function o(i,a,n){var l,u=!1,r=a===t.defaultQuality,o=t.quality||Math.min(t.video.height,t.video.width)+"p";l=o===t.defaultQuality?/(.+?)((\.(mp4|webm)$|$))/:/(-\d+p)?((\.(mp4|webm)$|$))/;var s=i.sources.map(function(e){if("abr"===a||n&&r||/mpegurl/i.test(e.type))return e;var i={type:e.type,src:e.src.replace(l,o===t.defaultQuality?"$1-"+a+"$2":r?"$2":"-"+a+"$2")};return i.src!==e.src&&(u=!0),i}),c=JSON.stringify(s);s.sort(function(e,t){var i,n=/mpegurl/i;return i="abr"===a?n.test(t.type)-n.test(e.type):n.test(e.type)-n.test(t.type)}),u=u||JSON.stringify(s)!==c;var f=e.extend({},i,{sources:s});return u?f:!1}var s=e.common,c=!1;t.pluginQualitySelectorEnabled||(t.pluginQualitySelectorEnabled=!0,e.support.inlineVideo&&(t.conf.qualities&&(t.conf.qualities="string"==typeof t.conf.qualities?t.conf.qualities.split(","):t.conf.qualities),e.bean.on(i,"click",".fp-quality-selector li",function(e){if(!/\bactive\b/.test(this.className)){var i,a=t.finished?0:t.video.time,n=e.currentTarget.getAttribute("data-quality");if(i=o(t.video,n),t.quality=n,!i)return;c=!0,t.load(i,function(){c=!1,t.finished=!1,a&&!t.live&&t.seek(a,function(){t.resume()})})}}),t.bind("load",function(e,t,i){if(t.qualities=i.qualities||t.conf.qualities||[],t.defaultQuality=i.defaultQuality||t.conf.defaultQuality,"string"==typeof t.qualities&&(t.qualities=t.qualities.split(",")),t.quality){var a=r(t.quality,t.qualities),n=o(i,a,!c);!c&&n&&(e.preventDefault(),t.loading=!1,t.load(n))}}),t.bind("ready",function(e,t,r){var o=/mpegurl/i.test(r.type)?"abr":l(r.src,t.qualities)||Math.min(r.height,r.width)+"p";u(),s.addClass(i,"quality-"+o);var c=s.find(".fp-ui",i)[0];if(s.removeNode(s.find(".fp-quality-selector",c)[0]),!(t.qualities.length<2)){t.quality=o;var f=s.createElement("ul",{"class":"fp-quality-selector"});c.appendChild(f),(a(r)&&n("application/x-mpegurl")||t.conf.swfHls)&&f.appendChild(s.createElement("li",{"data-quality":"abr","class":"abr"===o?"active":""},"Auto")),t.qualities.forEach(function(e){f.appendChild(s.createElement("li",{"data-quality":e,"class":e==o?"active":""},e))})}}),t.bind("unload",function(){u(),s.removeNode(s.find(".fp-quality-selector",i)[0])})))})}("object"==typeof module&&module.exports?require("flowplayer"):window.flowplayer);