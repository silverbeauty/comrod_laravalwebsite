/*

   AdSense plugin for Flowplayer HTML5

   Copyright (c) 2015, Flowplayer Oy (https://flowplayer.org)

   This source code is subject to the Flowplayer ASF Plugin License.
   Please see the full license agreement here: https://flowplayer.org/license/asf.html

   Requires: Flowplayer HTML5 version 6.x or greater.

*/
/*Version:1.1.0 (Rev:a07f28f)*/
//=================================================================================================
// Layer of compatibility with standards : JavaScript and ECMA Script
// Reference: http://es5.github.com/
// Many sources from: developer.mozilla.org
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array
//=================================================================================================
// Production steps of ECMA-262, Edition 5
Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),Date.now||(Date.now=function(){return+(new Date)}),Array.prototype.map||(Array.prototype.map=function(e,t){var n,r,i;if(this==null)throw new TypeError(" this is null or not defined");var s=Object(this),o=s.length>>>0;if(typeof e!="function")throw new TypeError(e+" is not a function");t&&(n=t),r=new Array(o),i=0;while(i<o){var u,a;i in s&&(u=s[i],a=e.call(n,u,i,s),r[i]=a),i++}return r}),Array.prototype.forEach||(Array.prototype.forEach=function(t,n){var r,i;if(this==null)throw new TypeError("this is null or not defined");var s=Object(this),o=s.length>>>0;if({}.toString.call(t)!=="[object Function]")throw new TypeError(t+" is not a function");n&&(r=n),i=0;while(i<o){var u;Object.prototype.hasOwnProperty.call(s,i)&&(u=s[i],t.call(r,u,i,s)),i++}}),Array.prototype.every||(Array.prototype.every=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments[1];for(var i=0;i<n;i++)if(i in t&&!e.call(r,t[i],i,t))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments[1];for(var i=0;i<n;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1}),function(){"use strict";var e=["join","reverse","sort","push","pop","shift","unshift","splice","concat","slice","indexOf","lastIndexOf","forEach","map","reduce","reduceRight","filter","some","every"],t=function(e){var t=Array.prototype[e];if(!t||Array[e])return;Array[e]=function(e){return t.apply(e,Array.prototype.slice.call(arguments,1))}},n=e.length;for(var r=0;r<n;r++)t(e[r])}();var flowplayer_ima={};flowplayer_ima.log={USE_DIV_CONSOLE:!1,DEBUG:{toString:"DEBUG"},TRACE:{toString:"TRACE"},debug:function(){flowplayer_ima.log.doLog(flowplayer_ima.log.DEBUG,arguments)},trace:function(){flowplayer_ima.log.doLog(flowplayer_ima.log.TRACE,arguments)},makeStackTrace:function(){try{throw new Error("makeStackTrace")}catch(e){return e.stack}},doLog:function(e,t){if(flowplayer_ima.log.USE_DIV_CONSOLE){var n=flowplayer.common,r=n.find("#fpima_console");if(r.length==0)return;t=Array.slice(t,0),t.unshift(e.toString+":");var i="";t.forEach(function(e,t){t!=0&&(i+=" "),i+=e});var s=n.createElement("div",{},i);n.append(r,s)}else{if(console==undefined||console.log.apply==undefined)return;t=Array.slice(t,0),t.unshift(e.toString+":"),console.log.apply(console,t)}}},flowplayer_ima.support={IS_TOUCH:flowplayer.support.touch,IS_IPAD:/iPad|MeeGo/.test(navigator.userAgent)&&!/CriOS/.test(navigator.userAgent),IS_IPHONE:/iP(hone|od)/i.test(navigator.userAgent)&&!/iPad/.test(navigator.userAgent)&&!/IEMobile/i.test(navigator.userAgent),IS_ANDROID:/Android/.test(navigator.userAgent),IS_UNSUPPORTED_IE:/MSIE [6-9]\./.test(navigator.userAgent)||/IEMobile\/(9|10)\./.test(navigator.userAgent)},flowplayer_ima.support.IS_IOS=flowplayer_ima.support.IS_IPAD||flowplayer_ima.support.IS_IPHONE,flowplayer_ima.support.IS_ANDROID_CHROME=flowplayer_ima.support.IS_ANDROID&&/Chrome/.test(navigator.userAgent)&&!/Version/.test(navigator.userAgent),flowplayer_ima.support.IS_UNSUPPORTED=flowplayer_ima.support.IS_UNSUPPORTED_IE,flowplayer_ima.data={CRC32_TABLE:[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],crc32:function(e,t){t==undefined&&(t=0);var n=0,r=0;t^=-1;for(var i=0,s=e.length;i<s;i++)n=(t^e[i])&255,r=flowplayer_ima.data.CRC32_TABLE[n],t=t>>>8^r;return t^=-1,t<0&&(t+=4294967296),t}},flowplayer_ima.text={stringToBytes:function(e){var t,n,r=[];for(var i=0;i<e.length;i+=1){t=e.charCodeAt(i),n=[];do n.push(t&255),t>>=8;while(t);r=r.concat(n.reverse())}return r},crc32:function(e){return flowplayer_ima.data.crc32(flowplayer_ima.text.stringToBytes(e))},zeropad:function(e){return e=parseInt(e,10),e>=10?e:"0"+e},formatTime:function(sec){with(flowplayer_ima.text){sec=sec||0;var h=Math.floor(sec/3600),min=Math.floor(sec/60);return sec-=min*60,h>=1?(min-=h*60,h+":"+zeropad(min)+":"+zeropad(sec)):zeropad(min)+":"+zeropad(sec)}}},flowplayer_ima.CONF_ELEM_CLASS_NAME="fp-ads-conf",flowplayer_ima.conf=function(e){var t=document.getElementsByTagName("script"),n=t[t.length-1];n.className=flowplayer_ima.CONF_ELEM_CLASS_NAME,n.inlineConf=e},flowplayer_ima.create=function(e,t,n){try{if(flowplayer_ima.support.IS_UNSUPPORTED)return;google.ima;var r=google.ima.settings,i=flowplayer.conf.ima,s,o;r.setPlayerType("Flowplayer"),r.setPlayerVersion(flowplayer.version),i&&(i.Locale&&(r.setLocale(i.Locale),delete i.Locale),i.Redirects&&(r.setNumRedirects(i.Redirects),delete i.Redirects)),s=(new flowplayer_ima.FlowplayerContainer).init(e,t),o=t.querySelector(".fp-ui"),(new flowplayer_ima.AdsPlugin).init(s,t,o,n)}catch(u){}},flowplayer_ima.hacks={},flowplayer_ima.hacks.discardEvents=flowplayer_ima.support.IS_ANDROID_CHROME,flowplayer_ima.hacks.useLoadedmetadata=flowplayer_ima.support.IS_IPHONE||flowplayer_ima.support.IS_ANDROID,flowplayer_ima.hacks.videoForce=flowplayer_ima.support.IS_IOS,flowplayer_ima.hacks.disableAdsEarlyPause=flowplayer_ima.support.IS_ANDROID,flowplayer_ima.FlowplayerContainer=function(){},flowplayer_ima.FlowplayerContainer.prototype={delegate:null,playerApi:null,playerElement:null,contentPlayback:null,receivedPlayOnce:!1,receivedFinish:!1,displayingAd:!1,controlbarHeight:0,fullscreenEnabled:!1,bean:flowplayer.bean,common:flowplayer.common,init:function(e,t){this.playerApi=e,this.playerElement=t,this.playerApi.on("load",this.onLoad.bind(this)),this.playerApi.on("ready",this.onReady.bind(this)),this.playerApi.on("resume",this.onResume.bind(this)),this.playerApi.on("progress",this.onProgress.bind(this)),this.playerApi.on("finish",this.onFinish.bind(this)),this.playerApi.on("fullscreen",this.onFullscreen.bind(this,!0)),this.playerApi.on("fullscreen-exit",this.onFullscreen.bind(this,!1)),this.contentPlayback={currentTime:null,duration:null},this.playerApi.off("finish.pl"),this.bean.off(t,"click.player"),this.bean.on(t,"click.playerContainer",this.onPlayerClick.bind(this));if(flowplayer_ima.support.IS_TOUCH){this.bean.off(t,"touchmove touchstart touchend");var n=this;n.hasMoved=!1,this.bean.on(t,"touchmove.playerContainer",this.onPlayerTouchMove.bind(this)),this.bean.on(t,"touchend.playerContainer",this.onPlayerTouchEnd.bind(this))}var r=this;query=r.playerApi.conf.query||".fp-playlist a",inside=query.indexOf("#")!==0,r.common.find(query,inside?r.playerElement:document).forEach(function(e){r.bean.on(e,"click",function(e){r.displayingAd&&(e.preventDefault(),e.stopPropagation())})}),r.common.find(".fp-prev,.fp-next",r.playerElement).forEach(function(e){r.bean.on(e,"click",function(e){r.displayingAd&&(e.preventDefault(),e.stopPropagation())})});var i="is-mouseover";forceControlbar=!this.common.hasClass(t,i)&&!this.common.hasClass(t,"fixed-controls"),forceControlbar&&this.common.addClass(t,i);var s=t.querySelector(".fp-ui .fp-controls"),o=Math.max(parseFloat(this.common.css(s,"bottom")),0);return this.controlbarHeight=parseFloat(this.common.css(s,"height"))+o,forceControlbar&&this.common.removeClass(t,i),this.createAdPlayElement(),this.hacksContext={},this.hacksContext.discardEvents={},this},hasPlaylist:function(){var e=this.playerApi.conf.playlist;return e&&e.length?!0:!1},createAdPlayElement:function(){var e=this.playerElement.querySelector(".fp-ui"),t=this.common.createElement("div",{css:{position:"absolute"},className:"ad-play"});this.common.prepend(e,t);var t=this.common.createElement("div",{css:{position:"absolute"},className:"ad-time"});this.common.prepend(e,t);var n=this.common.createElement("span",{className:"ad-remaining"});this.common.append(t,n)},resizeAdsElements:function(){var e=this.playerElement.querySelector(".fp-ui"),t=parseFloat(this.common.css(e,"width")),n=parseFloat(this.common.css(e,"height")),r=t*.11;this.common.css(this.playerElement.querySelector(".ad-play"),{left:(t-r)/2+"px",top:(n-r)/2+"px",width:r+"px",height:r+"px"})},onAdSkip:function(e){e.preventDefault(),e.stopPropagation(),this.delegate.onAdSkip()},onVideoStart:function(){this.delegate.onVideoStart()},onVideoProgress:function(e){this.delegate.onVideoProgress(e)},onVideoEnd:function(){this.delegate.onVideoEnd()},getContentPlayback:function(){return this.contentPlayback},getCurrentClipConf:function(){var e=this.playerApi,t=this.playerApi.conf;if(!this.hasPlaylist())return t.clip.ima;var n=null,r=e.video.index,i=this.delegate.mainConf.playlist,s=t.query||".fp-playlist a",o=s.indexOf("#")!==0,u=t.active||"is-active",a=this.common.find(s+"."+u+" ."+flowplayer_ima.CONF_ELEM_CLASS_NAME,o?this.playerElement:document)[0];return n=a?a.inlineConf:i?i[r]:t.playlist[r].ima,n&&t.advance!==!1&&(n.fpIndex=r),n},pause:function(){var e=this.playerElement.querySelector("video.fp-engine")||this.playerApi;e.pause()},play:function(){this.playerApi.engine.engineName!="flash"?(this.playerElement.querySelector("video.fp-engine").play(),this.common.removeClass(this.playerElement,"is-paused")):this.playerApi.resume()},nextClip:function(){var e=this.playerApi,t=e.conf.advance!==!1;this.hasPlaylist()&&t&&(!e.video.is_last||e.conf.loop)&&e.next()},onAdContainerClick:function(e){e.stopPropagation(),e.preventDefault(),this.displayingAd?this.delegate.toggleAd():this.playerApi.toggle()},handlePlayerCommonAction:function(e){this.initOnUserClickOnce||(this.initOnUserClickOnce=!0,this.delegate.initOnUserClick())},onPlayerClick:function(e){this.handlePlayerCommonAction();if(!this.displayingAd){var t=this.playerApi;if(this.common.hasClass(e.target,"fp-ui")||this.common.hasClass(e.target,"fp-engine")||e.flash)return e.preventDefault&&e.preventDefault(),t.toggle()}else{if(this.common.hasClass(e.target,"fp-mute")){var n=this.playerApi.muted?0:1;this.delegate.setVolume(n);return}e.preventDefault(),e.stopPropagation(),this.delegate.toggleAd()}},onPlayerTouchMove:function(e){var t=this;t.hasMoved=!0},onPlayerTouchEnd:function(e){this.handlePlayerCommonAction();if(this.displayingAd)return;var t=this.playerElement,n=this.playerApi,r=this;if(r.hasMoved){r.hasMoved=!1;return}if(n.playing&&!this.common.hasClass(t,"is-mouseover"))return this.common.addClass(t,"is-mouseover"),this.common.removeClass(t,"is-mouseout"),!1;if(n.paused&&this.common.hasClass(t,"is-mouseout")){n.toggle();if(flowplayer_ima.hacks.useLoadedmetadata){var i=this.playerElement.querySelector("video.fp-engine");i.removeAttribute("autoplay"),this.bean.off(i,"loadedmetadata.playerContainer"),this.bean.on(i,"loadedmetadata.playerContainer",this.onLoadedMetadata.bind(this))}}},showUIPlaying:function(e){this.common.toggleClass(this.playerElement,"is-paused",e),this.common.toggleClass(this.playerElement,"is-playing",!e)},showUIAdsPlaying:function(e){this.common.toggleClass(this.playerElement,"ad-is-paused",e),this.common.toggleClass(this.playerElement,"ad-is-playing",!e),this.showUIPlaying(e);var t=this.playerApi;e?this.resizeAdsElements():!t.conf.autoplay&&!t.video.time&&t.trigger("progress",[t,t.video.time]);var n=this.playerElement.querySelector(".ad-play"),r="backgroundImage";e&&this.common.css(n,r)=="none"&&this.common.css(this.playerElement.querySelector(".fp-ui"),{backgroundImage:this.common.css(elem,r)})},setupUIForAds:function(e){this.displayingAd=e,this.common.toggleClass(this.playerElement,"ad-is-visible",e),this.common.removeClass(this.playerElement,"ad-is-paused"),this.common.removeClass(this.playerElement,"ad-is-playing"),this.playerApi.disable(e),this.showUIPlaying(!e);if(e){var t=this.playerApi.muted?0:1;this.delegate.setVolume(t),setTimeout(this.showUIPlaying.bind(this,!e),1e3),this.onAdTime(-1,-1)}},onAdLoaded:function(e){this.common.toggleClass(this.playerElement,"ad-is-skippable",e.skippable),this.common.removeClass(this.playerElement,"ad-is-pre-skippable"),this.common.removeClass(this.playerElement,"ad-is-skippable-now")},onAdTime:function(e,t){var n=this.playerElement.querySelector(".ad-time .ad-remaining");this.common.toggleClass(n,"ad-time-undefined",e==-1),this.common.html(n,e==-1?"":flowplayer_ima.text.formatTime(Math.round(e)))},onFullscreen:function(e){this.fullscreenEnabled=e,setTimeout(function(){this.resizeAdsElements(),this.delegate.onFullscreen(e)}.bind(this),e?600:700)},onLoad:function(){this.displayingAd&&this.playerApi.one("ready",function(e,t){t.stop()}),this.receivedPlayOnce=!1,this.receivedFinish=!1},onReadyCommon:function(){var e=this.playerApi,t=this.playerElement.querySelector("video.fp-engine");t&&(e.conf.autoplay&&!e.video.index&&(this.bean.one(t,"pause",function(){t.play()}),t.pause()),this.bean.on(t,"play",function(){e.disabled&&t.pause()})),this.contentPlayback.currentTime=e.video.time,this.contentPlayback.duration=e.video.duration,e.conf.autoplay&&e.trigger("progress",[e,e.video.time])},onReady:function(){if(flowplayer_ima.hacks.useLoadedmetadata)return;if(flowplayer_ima.hacks.discardEvents){var e=this.playerApi.video;this.hacksContext.discardEvents.discard=!(e.videoHeight||e.videoWidth||e.height||e.width),this.hacksContext.discardEvents.events==null&&(this.hacksContext.discardEvents.events={});if(this.hacksContext.discardEvents.discard){this.hacksContext.discardEvents.events.onReady=!0;return}this.hacksContext.discardEvents.events.onResume&&(this.receivedPlayOnce||(this.receivedPlayOnce=!0,this.onVideoStart())),this.hacksContext.discardEvents.events={}}this.onReadyCommon()},onLoadedMetadata:function(){this.onReadyCommon(),this.receivedPlayOnce||(this.receivedPlayOnce=!0,this.onVideoStart())},onResume:function(){if(flowplayer_ima.hacks.discardEvents&&this.hacksContext.discardEvents.discard){this.hacksContext.discardEvents.events.onResume=!0;return}this.receivedPlayOnce?this.receivedFinish&&(this.receivedFinish=!1,this.hasPlaylist()?this.playerApi.next():this.playerApi.seek(0,function(e,t){t.resume()})):(this.receivedPlayOnce=!0,this.onVideoStart())},onProgress:function(){this.contentPlayback.currentTime=this.playerApi.video.time,this.onVideoProgress(this.playerApi.video.time)},onFinish:function(){this.hasPlaylist()||(this.receivedPlayOnce=!1),this.receivedFinish=!0,this.onVideoEnd()}},flowplayer_ima.AdsPlugin=function(){},flowplayer_ima.AdsPlugin.prototype={ADS_STATE:{REQUESTING:1,LOADED:2,PLAYING:3,SHOWING_NON_LINEAR:4},ADS_SKIP_OFFSET:5,playerContainer:null,adContainerElement:null,userAdEventElement:null,adDisplayContainer:null,adsLoader:null,adsManager:null,adIntervalTimer:null,containerSize:null,mainConf:null,currentClipConf:null,currentAd:null,adsState:null,adsPlaylistCompleted:!1,usingAdRules:!1,adsEarlyPause:!1,videoEnded:!1,adPaused:!1,bean:flowplayer.bean,common:flowplayer.common,extend:flowplayer.extend,init:function(e,t,n,r){this.playerContainer=e,this.playerContainer.delegate=this,this.containerSize={width:parseFloat(this.common.css(n,"width")),height:parseFloat(this.common.css(n,"height"))},this.userAdEventElement=t,this.adContainerElement=this.createAdContainerElement(n),this.setupUIForAds(!1),this.bean.on(this.adContainerElement,"click touchend",this.onAdContainerClick.bind(this)),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainerElement),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1);var i=t.querySelector("."+flowplayer_ima.CONF_ELEM_CLASS_NAME);return i!=null&&(r=i.inlineConf),this.mainConf=this.extend({},flowplayer.conf.ima,r),this.hacksContext={},this.hacksContext.videoForce={},this},initOnUserClick:function(){this.adDisplayContainer.initialize()},createAdContainerElement:function(e){var t=this.common.createElement("div",{css:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},className:"adContainer"});return this.common.prepend(e,t),this.bean.on(t,"mouseleave",function(e){e.stopPropagation()}),t},getAdContainerCurrentSize:function(){var e=this.adContainerElement.parentNode,t={width:parseFloat(this.common.css(e,"width")),height:parseFloat(this.common.css(e,"height")),viewMode:this.playerContainer.fullscreenEnabled?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL};return t},toggleAd:function(){this.adsState!==this.ADS_STATE.SHOWING_NON_LINEAR&&(this.adPaused?this.adsManager.resume():this.adsManager.pause(),this.adPaused=!this.adPaused,this.playerContainer.showUIAdsPlaying(this.adPaused))},setVolume:function(e){if(this.adsManager==null)return;this.adsManager.setVolume(e)},onAdContainerClick:function(e){this.playerContainer.onAdContainerClick(e)},onAdsManagerLoaded:function(e){this.adsManager!=null&&(this.adsManager.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdErrorLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequestedLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequestedLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAdEventLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.LOADED,this.onAdEventLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.STARTED,this.onAdEventLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdEventLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.CLICK,this.onAdEventLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.USER_CLOSE,this.onAdEventLr),this.adsManager.removeEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdEventLr),this.bean.off(window,"resize.lr",this.onWindowResizeLr),this.adsManager.destroy(),this.adsManager=null),adsRenderingSettings=null,this.adsManager=e.getAdsManager(this.playerContainer.getContentPlayback(),adsRenderingSettings),this.onAdErrorLr=this.onAdError.bind(this),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdErrorLr),this.onContentPauseRequestedLr=this.onContentPauseRequested.bind(this),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequestedLr),this.onContentResumeRequestedLr=this.onContentResumeRequested.bind(this),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequestedLr),this.onAdEventLr=this.onAdEvent.bind(this),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAdEventLr),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,this.onAdEventLr),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,this.onAdEventLr),this.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,this.onAdEventLr),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdEventLr),this.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,this.onAdEventLr),this.adsManager.addEventListener(google.ima.AdEvent.Type.USER_CLOSE,this.onAdEventLr),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdEventLr);try{this.setupUIForAds(!0);var t=this.getAdContainerCurrentSize();this.adsManager.init(t.width,t.height,t.viewMode),this.adsManager.start()}catch(n){}this.onWindowResizeLr=this.onWindowResize.bind(this),this.bean.on(window,"resize.lr",this.onWindowResizeLr)},onWindowResize:function(){var e=this.getAdContainerCurrentSize(),t=this.adsState==this.ADS_STATE.SHOWING_NON_LINEAR?e.height-this.playerContainer.controlbarHeight:e.height;this.adsManager.resize(e.width,t,e.viewMode),this.playerContainer.resizeAdsElements()},commonPath:function(e){return e.split(".").length==1?null:e.split(".").slice(-(1+0)).join(".")},checkForAds:function(e){if(this.adsState!=null&&this.adsState!=this.ADS_STATE.SHOWING_NON_LINEAR)return!0;if(this.currentClipConf==null)return!1;var t=null;if(this.currentClipConf.adRules)t={adTagUrl:this.currentClipConf.adRules},delete this.currentClipConf.adRules,this.adsEarlyPause=!0,this.usingAdRules=!0;else{var n=this.currentClipConf.ads;if(n==null||n.length==0)return!1;var r,i;if(e==0)r=0,i=1,t=n[r],t.time!=e&&(t=null);else if(e==-1)r=n.length-1,i=1,t=n[r],t.time!=e&&(t=null);else{r=0,i=0;for(var s=0;s<n.length;s++){var o=n[s];if(o.time==-1||o.time>e)break;t=o,r=s,i++}}if(t==null)return!1;n.splice(r-i+1,i),e==0||e==-1?this.adsEarlyPause=!0:this.adsEarlyPause=!1,this.usingAdRules=!1}flowplayer_ima.hacks.disableAdsEarlyPause&&!flowplayer_ima.hacks.useLoadedmetadata&&(this.adsEarlyPause=!1),this.adsEarlyPauseTimeout&&(clearTimeout(this.adsEarlyPauseTimeout),this.adsEarlyPauseTimeout=null);if(this.adsEarlyPause&&!flowplayer_ima.hacks.useLoadedmetadata){this.doContentPause();var u=4e3;this.adsEarlyPauseTimeout=setTimeout(function(){this.adsEarlyPauseTimeout=null;if(this.adsState!=this.ADS_STATE.REQUESTING)return;this.doContentResume()}.bind(this),u)}return this.adsPlaylistCompleted=!1,this.requestAds(t),!0},requestAds:function(e){this.adsState==this.ADS_STATE.SHOWING_NON_LINEAR&&(this.adsManager.stop(),this.adsState=null),this.adsState=this.ADS_STATE.REQUESTING;var t=new google.ima.AdsRequest;t.adTagUrl=e.adTagUrl,t.linearAdSlotWidth=this.containerSize.width,t.linearAdSlotHeight=this.containerSize.height,t.nonLinearAdSlotWidth=this.containerSize.width,t.nonLinearAdSlotHeight=this.containerSize.height-this.playerContainer.controlbarHeight,this.adsLoader.requestAds(t)},onAdError:function(e){this.adsEarlyPause&&this.doContentResume(),this.adsState=null,this.currentAd=null,this.fireUserAdEvent("error",e)},onFullscreen:function(e){if(this.adsManager==null)return;var t=this.getAdContainerCurrentSize();this.adsManager.resize(t.width,t.height-this.playerContainer.controlbarHeight,t.viewMode)},onVideoStart:function(){this.videoEnded=!1,this.buildCurrentClipConf();var e=this.checkForAds(0);flowplayer_ima.hacks.useLoadedmetadata&&!e&&this.doContentResume()},onVideoProgress:function(e){this.checkForAds(e)},onVideoEnd:function(){this.videoEnded=!0,this.adsLoader.contentComplete(),this.checkForAds(-1)||this.usingAdRules&&!this.adsPlaylistCompleted||this.playerContainer.nextClip()},doContentPause:function(){this.playerContainer.pause(),this.setupUIForAds(!0),this.playerContainer.setupUIForAds(!0)},onContentPauseRequested:function(){this.doContentPause(),this.adsState=this.ADS_STATE.PLAYING},onContentResumeRequested:function(){this.doContentResume(),this.adsState=null,this.currentAd=null,this.adIntervalTimer&&(clearInterval(this.adIntervalTimer),this.adIntervalTimer=null)},doContentResume:function(){this.playerContainer.setupUIForAds(!1),this.setupUIForAds(!1),this.videoEnded?this.playerContainer.nextClip():this.playerContainer.play()},setupUIForAds:function(e){this.adContainerElement.style.display=e?"block":"none"},onAdEvent:function(e){var t=e.getAd();switch(e.type){case google.ima.AdEvent.Type.LOADED:this.adsState=this.ADS_STATE.LOADED,this.currentAd={linear:t.isLinear(),skippable:t.isSkippable()},this.playerContainer.onAdLoaded(this.currentAd),this.adIntervalTimer=null;if(!t.isLinear()){this.adsEarlyPause&&this.doContentResume(),this.adsState=this.ADS_STATE.SHOWING_NON_LINEAR,this.setupUIForAds(!0);var n=this.getAdContainerCurrentSize();this.adsManager.resize(n.width,n.height-this.playerContainer.controlbarHeight,n.viewMode)}if(flowplayer_ima.hacks.videoForce&&!this.usingAdRules){if(this.hacksContext.videoForce.startedOnce){var r=this.adContainerElement.querySelector("video");this.hacksContext.videoForce.defined||(this.hacksContext.videoForce.defined=!0,this.hacksContext.videoForce.videoElem=r,this.hacksContext.videoForce.pollTimes=[1e3,2e3,4e3],this.hacksContext.videoForce.pollFunc=function(){this.timer=null,this.videoElem.readyState==0&&(this.videoElem.load(),this.bindPoll())},this.hacksContext.videoForce.bindPoll=function(){if(this.pollTimeIndex>=this.pollTimes.length)return;var e=this.pollTimes[this.pollTimeIndex++];this.timer=setTimeout(this.pollFunc.bind(this),e)},this.hacksContext.videoForce.start=function(){this.pollTimeIndex=0,this.bindPoll()},this.hacksContext.videoForce.stop=function(){clearTimeout(this.timer),this.timer=null},this.bean.on(r,"canplay",function(){(({visible:!0,hidden:!0}))[this.parentNode.style.visibility]&&(this.parentNode.style.visibility="visible"),this.play()})),{visible:!0,hidden:!0}[r.parentNode.style.visibility]&&(r.parentNode.style.visibility="hidden"),r=null,this.hacksContext.videoForce.start()}this.hacksContext.videoForce.startedOnce=!0}break;case google.ima.AdEvent.Type.STARTED:t.isLinear()&&(this.adPaused=!1,this.playerContainer.showUIAdsPlaying(this.adPaused),this.adIntervalTimer=setInterval(this.onAdIntervalTimer.bind(this),300)),this.fireUserAdEvent("started",e);break;case google.ima.AdEvent.Type.PAUSED:this.adPaused=!0,this.playerContainer.showUIAdsPlaying(this.adPaused),this.fireUserAdEvent("paused",e);break;case google.ima.AdEvent.Type.COMPLETE:t.isLinear()&&(clearInterval(this.adIntervalTimer),this.adIntervalTimer=null,this.hacksContext.videoForce.defined&&this.hacksContext.videoForce.stop()),this.fireUserAdEvent("completed",e);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.adsPlaylistCompleted=!0,this.fireUserAdEvent("allCompleted",e);break;case google.ima.AdEvent.Type.CLICK:this.fireUserAdEvent("clicked",e);break;case google.ima.AdEvent.Type.USER_CLOSE:this.fireUserAdEvent("closed",e);break;case google.ima.AdEvent.Type.SKIPPED:this.fireUserAdEvent("skipped",e)}},fireUserAdEvent:function(e,t){var n=e.charAt(0).toUpperCase()+e.slice(1),r="ad"+n,i=document,s=i.documentElement||{},o=s.addEventListener,u;o?(u=i.createEvent("UIEvents"),u.initUIEvent(r,!0,!0,window,1)):(u=i.createEventObject(),u.eventType=r);var a=t.getAd?t.getAd():null;a&&(u.linear=a.isLinear(),u.duration=a.getDuration(),this.currentAd&&this.currentAd.duration!=null&&(u.duration=this.currentAd.duration),u.remainingTime=this.adsManager.getRemainingTime(),u.time=-1,u.duration!=-1&&u.remainingTime!=-1&&(u.time=u.duration-u.remainingTime));if(this.mainConf.events){var f="onAd"+n,l=this.mainConf.events[f];l&&l(u)}this.bean.fire(this.userAdEventElement,r,[u])},onAdSkip:function(){this.adsManager.stop()},onAdIntervalTimer:function(){var e=this.adsManager.getRemainingTime();if(e==-1||e==1)return;this.currentAd.duration==null&&(this.currentAd.duration=e);var t=this.currentAd.duration,n=t-e,r=-1;this.currentAd.skippable&&(r=this.ADS_SKIP_OFFSET-n,r<0&&(r=0)),e=Math.ceil(e),r=Math.ceil(r),this.playerContainer.onAdTime(e,r)}},flowplayer(function(e,t){var n=e.conf.ima;n!==!1&&flowplayer_ima.create(e,t,n)}),flowplayer_ima.AdsPlugin.prototype.buildCurrentClipConf=function(){var e="https://googleads.g.doubleclick.net/pagead/ads",t="ca-video-pub-1256482085642647",n=this.extend,r=n({},this.mainConf),i=["ad_type","description_url","adsafe","hl","max_ad_duration","min_ad_duration","sdmax","adtest","cust_age","cust_gender"];this.currentClipConf=n({},this.playerContainer.getCurrentClipConf()),this.currentClipConf.ads||(this.currentClipConf.ads=r.ads),delete this.currentClipConf.adRules,delete this.currentClipConf.adTagUrl;if(this.currentClipConf.ads){var s=[],o=this.currentClipConf,u="video",a="video_image_text",f="standardvideo";o.ads.forEach(function(n){if(typeof n.time=="number"){i.forEach(function(e){n[e]===undefined&&(n[e]=o[e]!==undefined?o[e]:r[e])});var l=n.fpIndex,c=n.adtest;n.ad_type||(n.ad_type=a),flowplayer.support.inlineVideo?n.ad_type==="skippablevideo"&&(n.time!==0||l)&&(n.ad_type=u):n.type=f,n.ad_type.indexOf("video")<0?(delete n.min_ad_duration,delete n.max_ad_duration,delete n.sdmax):n.ad_type===f&&delete n.sdmax;switch(c){case!0:case"on":n.adtest="on";break;case!1:case"off":n.adtest="off";break;default:delete n.adtest}n.description_url&&n.description_url.indexOf("http")!==0&&delete n.description_url;var h=e+"?client="+t+"&slotname="+'comroads500';i.forEach(function(e){var t=n[e];if(typeof t=="string"||typeof t=="number")h+="&"+e+"="+encodeURIComponent(t)}),n.description_url||(h+="&description_url="+'http%3A%2F%2Fcomroads.com'),n.adTagUrl=h,s.push(n)}}),s.length?(s.sort(function(e,t){return e=e.time==-1?999999:e.time,t=t.time==-1?999999:t.time,e-t}),this.currentClipConf.ads=s):delete this.currentClipConf.ads}};